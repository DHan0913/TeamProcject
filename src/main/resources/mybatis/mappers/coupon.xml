<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="coupon">

<!-- 쿠폰 삽입 -->
    <insert id="createCoupon" parameterType="com.example.model.Coupon">
        INSERT INTO coupons (coupon_id, coupon_code, points, expiry_date, issued_date)
        VALUES (coupon_seq.NEXTVAL, #{couponCode}, #{points}, #{expiryDate}, SYSDATE)
    </insert>

    <!-- 유저에게 쿠폰 발급 -->
    <insert id="issueCouponToUser" parameterType="map">
        INSERT INTO user_coupons (user_coupon_id, user_no, coupon_id, issued_date)
        VALUES (user_coupon_seq.NEXTVAL, #{userNo}, 
            (SELECT coupon_id FROM coupons WHERE coupon_code = #{couponCode}), 
            SYSDATE)
    </insert>

    <!-- 모든 쿠폰 조회 (필요한 경우) -->
    <select id="getAllCoupons" resultType="com.example.model.Coupon">
        SELECT coupon_id, coupon_code, points, expiry_date, issued_date
        FROM coupons
    </select>

</mapper>